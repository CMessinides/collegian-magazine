
{{ define "hero" }}
  {{ $featured := first 4 (where (where .Site.Pages "Section" "article") "Params.featured" true) }}

  {{ if $featured }}
    {{ $first := index $featured 0 }}

    <div class="hero {{ if gt (len $featured) 1 }}hero--has-aside{{ end }}">
      <div class="hero__banner">
        <div class="hero__fade"></div>
        <div class="hero__image" {{ with $first.Params.cover_image }}style="background-image:url({{ . | safeCSS }});"{{ end }}>
        </div>
      </div>
      <div class="hero__inner lg-grid">

        <h1 class="hide">Featured</h1>
        {{ range first 1 $featured }}
          {{ .Render "hero-insert" }}
        {{ end }}

        {{ with (after 1 $featured) }}
        <aside class="hero__featured lg-wid-5">
          <h2 class="h4 hero__label">More Featured</h2>
          {{ partial "card-stack.html" . }}
          </ul>
        </aside>
        {{ end }}

      </div>

    </div>

  {{ end }}

{{ end }}

{{ define "content" }}
    <section class="">
      <h1 class="h4">In the Latest Issue</h1>
      <ul class="list">
        {{ range first 5 (where (where .Site.Pages "Section" "article") "Params.featured" "ne" "true") }}
        <li>{{ .Render "card-beta" }}</li>
        {{ end }}
      </ul>
      <a href="{{ "/article/" | absURL }}">All articles</a>
    </section>

    {{ $first_announce := index (where .Site.Pages "Section" "announcement") 0 }}
    {{ if $first_announce }}
    <section class="gtrs-1-a md-gtrs-2-a section--bold">
      <h1 class="h4">Announcement</h1>
      {{ $first_announce.Render "card-beta" }}
      <a href="{{ "/announcement/" | absURL }}">More announcements</a>
    </section>
    {{ end }}

    <section class="gtrs-1-a md-gtrs-2-a">
      <h1 class="h4">Categories</h1>
      <ul class="list">
        {{ range $name, $category := .Site.Taxonomies.categories }}
        <li class="wid-6">
          <h2 class="h2">{{ $name }}</h2>
          <ul class="list">
            {{ range first 3 $category.Pages}}
            <li>{{ .Render "card-gamma" }}</li>
            {{ end }}
          </ul>
          <a href="{{ $name | urlize | printf "/categories/%s/" | absURL }}">More in {{ $name }}</a>
        </li>
        {{ end }}
      </ul>
    </section>
{{ end }}
